<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.28">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Introduction to Data Analysis with R - 2&nbsp; Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tidy-data.html" rel="next">
<link href="./intro.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="style.css">
<meta property="og:title" content="Introduction to Data Analysis with R - 2&nbsp; Data Wrangling">
<meta property="og:description" content="Right after the setup-chunk, where we specify common code execution options like showing the code (echo) or hiding messages and warnings, the first thing we usually do at the top of a new analysis…">
<meta property="og:site-name" content="Introduction to Data Analysis with R">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Wrangling</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Analysis with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jmbuhr/dataintro" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Hello and welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrangling.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidy-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tidy data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functional-programming.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Functional Programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability-and-hypothesis-testing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probability and Hypothesis Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributions-summaries-and-dimensionality-reduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distributions, Summaries and Dimensionality Reduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fallacies-correlation-and-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Fallacies, Correlation and Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./freestyle.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Freestyle</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">Resources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#a-data-analysis-workflow" id="toc-a-data-analysis-workflow" class="nav-link active" data-scroll-target="#a-data-analysis-workflow"> <span class="header-section-number">2.1</span> A Data Analysis Workflow</a></li>
  <li><a href="#reading-data-with-readr" id="toc-reading-data-with-readr" class="nav-link" data-scroll-target="#reading-data-with-readr"> <span class="header-section-number">2.2</span> Reading Data with <code>readr</code></a></li>
  <li>
<a href="#a-project-based-workflow" id="toc-a-project-based-workflow" class="nav-link" data-scroll-target="#a-project-based-workflow"> <span class="header-section-number">2.3</span> A Project-based Workflow</a>
  <ul class="collapse">
<li><a href="#common-hurdles-when-importing-data" id="toc-common-hurdles-when-importing-data" class="nav-link" data-scroll-target="#common-hurdles-when-importing-data"> <span class="header-section-number">2.3.1</span> Common Hurdles when Importing Data</a></li>
  </ul>
</li>
  <li>
<a href="#wrangling-data-with-dplyr" id="toc-wrangling-data-with-dplyr" class="nav-link" data-scroll-target="#wrangling-data-with-dplyr"> <span class="header-section-number">2.4</span> Wrangling Data with <code>dplyr</code></a>
  <ul class="collapse">
<li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"> <span class="header-section-number">2.4.1</span> select</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"> <span class="header-section-number">2.4.2</span> filter</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"> <span class="header-section-number">2.4.3</span> mutate</a></li>
  <li><a href="#interlude-begind-the-magic-handling-data-with-base-r" id="toc-interlude-begind-the-magic-handling-data-with-base-r" class="nav-link" data-scroll-target="#interlude-begind-the-magic-handling-data-with-base-r"> <span class="header-section-number">2.4.4</span> Interlude: Begind the magic, handling data with base-R</a></li>
  <li><a href="#the-pipe" id="toc-the-pipe" class="nav-link" data-scroll-target="#the-pipe"> <span class="header-section-number">2.4.5</span> The pipe <code>%&gt;%</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"> <span class="header-section-number">2.4.6</span> arrange</a></li>
  <li><a href="#summarise" id="toc-summarise" class="nav-link" data-scroll-target="#summarise"> <span class="header-section-number">2.4.7</span> summarise</a></li>
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"> <span class="header-section-number">2.4.8</span> group_by</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others"> <span class="header-section-number">2.4.9</span> others:</a></li>
  </ul>
</li>
  <li><a href="#visualization-and-our-first-encounter-with-factors" id="toc-visualization-and-our-first-encounter-with-factors" class="nav-link" data-scroll-target="#visualization-and-our-first-encounter-with-factors"> <span class="header-section-number">2.5</span> Visualization and our first encounter with <code>factor</code>s</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"> <span class="header-section-number">2.6</span> Exercises</a></li>
  <li>
<a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"> <span class="header-section-number">2.7</span> Resources</a>
  <ul class="collapse">
<li><a href="#package-documentation" id="toc-package-documentation" class="nav-link" data-scroll-target="#package-documentation"> <span class="header-section-number">2.7.1</span> Package Documentation</a></li>
  <li><a href="#getting-help" id="toc-getting-help" class="nav-link" data-scroll-target="#getting-help"> <span class="header-section-number">2.7.2</span> Getting Help</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jmbuhr/dataintro/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/jmbuhr/dataintro/blob/main/data-wrangling.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Wrangling</span>
</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><blockquote class="blockquote">
<p>… in which we explore the typical data analysis workflow with the tidyverse, wrangle different kinds of data and learn about factors.</p>
</blockquote>
<div class="video-container">
<iframe class="video" src="https://www.youtube.com/embed/oCYn2pHfizg?vq=hd1080" allowfullscreen="">
</iframe>
</div>
<blockquote class="blockquote">
<p><strong>Note</strong>:<br>
I try to be vocal about what the code does in plain English while I type it and learning the “translations” of symbols and keywords can help you, too. After a while, programming can feel a lot more like having a conversation with your digital assistant or a helpful friend. The boundary between human languages and computer languages is more blurry than you might think.</p>
</blockquote>
<p>Right after the setup-chunk, where we specify common code execution options like showing the code (<code>echo</code>) or hiding messages and warnings, the first thing we usually do at the top of a new analysis is load the packages we are going to used. If I later find that I need some more, I come back here and add it to the list, so that people reading my code can see straight away, what they have to install in order for them to run the code themselves.</p>
<div class="cell" data-hash="data-wrangling_cache/html/loading-packages_8efb2d1d0fdff5c60d6294874ebc76bb">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-data-analysis-workflow" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="a-data-analysis-workflow">
<span class="header-section-number">2.1</span> A Data Analysis Workflow</h2>
<p>We are getting close to importing our very first dataset from a file into R. Generally, this is the first thing that needs to happen with any data analysis and we will cover it today. The data I provided is already pretty tidy so we will start with that and build some visualizations. The communicate-part is also covered, because we are working in Rmarkdown after all, which is designed to communicate our findings. Next week we will also have a look at some less tidy data, but not before having defined what “tidy data” is.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/workflow-wickham.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure from <span class="citation" data-cites="wickhamDataScienceImport2017">Wickham and Grolemund (<a href="references.html#ref-wickhamDataScienceImport2017" role="doc-biblioref">2017</a>)</span>.</figcaption><p></p>
</figure>
</div>
</section><section id="reading-data-with-readr" class="level2 page-columns page-full" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="reading-data-with-readr">
<span class="header-section-number">2.2</span> Reading Data with <code>readr</code>
</h2>
<aside><p><a href="https://readr.tidyverse.org/"> <img src="images/readr.png" class="img-fluid" alt="The readr logo"></a></p>
</aside><p>The package responsible for loading data in the tidyverse is called <code>readr</code>, so we start by loading the whole tidyverse.</p>
<p>Note, that in general, we could also load just the <code>readr</code> package with <code><a href="https://readr.tidyverse.org">library(readr)</a></code>, but we need the rest of the tidyverse later on anyways. There is also the option to not load a package at all but rather only use one function from a package by prefixing the function with the package name and two colons (<code>::</code>) Like so: <code>readr::read_csv("...")</code>.</p>
<p>Without further ado, let’s download the data for today. In fact, there are multiple ways to go about this. We could download the whole course folder from GitHub by following the link that says “View book source” in the left sidebar (or the pancake-menu in mobile view) and then using the download button on GitHub:</p>
<p><img src="images/download_repo.png" class="img-fluid"></p>
<p>The data is all in a folder called <code>data</code> and organized into sub-folders with the lecture number. So everything you need for today can be found in folder <code>02</code>.</p>
<p>On GitHub, we can also download individual files, but for plain text files you need to remember one extra step. If you have already clicked on the file in GitHub and can see it’s content, it is tempting to copy and paste the link from the browser bar and use R’s <code>download.file</code> function. However, this is just the link to the part of the website where GitHub shows the file, not a link to the actual file. We can get the correct link by clicking on the <strong>Raw</strong> button:</p>
<p><img src="images/github-raw.png" class="img-fluid"></p>
<p>Then we can use this to download the file:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-2_feb4b505c6351b9e9888aee930c5e7d2">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/jmbuhr/dataintro/main/data/02/gapminder.csv"</span>, <span class="st">"example-download.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you look into the source for this lecture you will find that I set the chunk option <code>eval=FALSE</code>, meaning the code will not but run. I don’t want to download the file again every time I make a change to the course script.</p>
<p>A common error I see people having with <code>download.file</code> is trying to download a file into e.g.&nbsp;a folder called <code>data</code> without first creating said folder. If you get one of those <code>No such file or directory</code> errors, this is the most likely cause.</p>
<ul>
<li>read gapminder data (csv)</li>
<li>read csv also works with url
<ul>
<li>but you probably also want a local copy</li>
<li>write_csv and friends</li>
</ul>
</li>
<li>
<code>View</code> and ctrl+click</li>
</ul>
<p>With our data downloaded, we can make use of RStudio’s autocompletion to complete the file-path to our data inside of quotation marks. We can trigger it explicitly with <code>ctrl+space</code> or <code>tab</code>.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-3_91c4f490c09584527b8f63ac7a531704">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/02/gapminder.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>readr</code> will also tell you the datatypes it guessed for the columns. Let’s inspect our dataset:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-4_3e1d1ddaa839558c94de1a56a654e0e8">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>The gapminder dataset <span class="citation" data-cites="bryanGapminderDataGapminder2017">(<a href="references.html#ref-bryanGapminderDataGapminder2017" role="doc-biblioref">Bryan 2017</a>)</span> is an excerpt from the <a href="https://www.gapminder.org/">gapminder project</a> and contains the life expectancy at birth for 142 countries at 5 year intervals between 1952 and 2007. It also contains the population and the Gross Domestic Product (GDP) per Inhabitant. We will built a visualization later on.</p>
<p>A cool trick for when you have your data in a variable is the <code>View</code> function. The same effect can be reached by <code>ctrl+click</code>ing on it or by using the button next to it in the environment panel.</p>
<p>It should be noted that the <code>read_csv</code> function can also read data from links and will download it automatically. However, in order to have the data nice and safe, we might want to save if somewhere, just in case (links can change, especially when it is someone else’s link).</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-5_4f67f37b25673488efa0e1af67b9917c">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">our_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/jmbuhr/dataintro/main/data/02/gapminder.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">our_data</span>, <span class="st">"our-data.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="a-project-based-workflow" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="a-project-based-workflow">
<span class="header-section-number">2.3</span> A Project-based Workflow</h2>
<p>Last week we simply went ahead and created a script file and an Rmarkdown file in some folder on our computer. But how does R known, where the script is? How does it know, where to look, when we tell it to read in a file or save a plot? The main folder where R starts is called the <strong>working directory</strong>. To find out, what our current working directory is, we execute the function <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code> for get working directory:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-6_1f9734be3fe31f9b52161a170ca865a7">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/home/jannik/teaching/dataintro"</code></pre>
</div>
</div>
<p>RStudio projects set this working directory automatically, which is very convenient. It makes it easier for us to share code and projects, by simply copying the whole folder. But we have to follow one prerequisite. Our file paths need to be <strong>relative</strong>, not absolute. An absolute file path starts at the root of our operating system, so on windows you will see something like <code>C:\\User\Jannik\Documents\...</code> while on mac and linux it starts with <code>/home/jannik/Documents/...</code>. For example, I could read the same gapminder dataset by:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-7_74145bea1689b19260d6425cd02dc172">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"/home/jannik/Documents/projects/teaching/dataintro/data/02/gapminder.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But this is a terrible idea! If I ever move my analysis folder, this file path will no longer be correct and if someone else tries to run my code they will most certainly not be called Jannik and have the exact same directory structure. So it will also not work.</p>
<p>In order for our work to be portable, robust and shareable, we need our file paths to be relative to the root of our project (which is set by the RStudio project).</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-8_9e230d8a2acd19a430bf4a5643bb2901">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./data/02/gapminder.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, <code>./</code> refers to the current working directory, which is set by the RStudio project. It can also be omitted (e.g.&nbsp;<code>data/02/...</code>), but the path can’t start with <code>/</code> because this would mark it as an absolute path.</p>
<p>There is also a function to set the working directory ourselves (it is called <code>setwd</code>), but I ask you to never use it. Because in order to use it, you would have to specify the working directory using an absolute path, rendering the script useless for anyone that is not you. Use RStudio projects instead.</p>
<p>There is one thing I didn’t tell you about Rmarkdown documents, yet. Their working directory is always the folder they are in, even if they are in some subdirectory of a project. In a way this also means that you don’t necessarily need a project to work with Rmarkdown, but having one anyway makes it easier to keep track of your files and have a consistent structure.</p>
<section id="common-hurdles-when-importing-data" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="common-hurdles-when-importing-data">
<span class="header-section-number">2.3.1</span> Common Hurdles when Importing Data</h3>
<p>So, importing the gapminder csv went smoothly. But this will not always be the case. We will now look at common hurdles when importing data.</p>
<p>The function we just used was called <code>read_csv</code>, because it reads a file format that consists of <strong>comma separated values</strong>. Look at the raw file in a text editor (not word) like notepad or RStudio to see why. But the file extension <code>.csv</code> can sometimes be lying…</p>
<p>Because in German, the comma is used to separate decimal numbers (vs.&nbsp;the dot in English), a lot of Software will output a different type of csv-file when configured in German. It will still call it csv, but actually it is separated by semicolons! We have a special function for this:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-9_69f292e8d3603e65dc24797d486f7980">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2</a></span><span class="op">(</span><span class="st">"data/02/gapminder_csv2.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When looking through the autocompletion options that pop up when you are typing the function name, you might have noticed a similar function <code>read.csv</code> and <code>read.csv2</code>. These are the functions that come with R, without any packages like the tidyverse. You can of course use those as well, but the tidyverse functions provide a more consistent experience and have less surprising quirks. I am teaching the tidyverse first because it allows you to do more while having to learn less edge cases.</p>
<p>If we look at yet another file <code>gapminder_tsv.txt</code>, we notice that the file extension doesn’t tell us much about the format, only that it is text (as opposed to a binary format only computers can read). If we look into the file:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-10_bd5a2508fdeb17a395308d24a90330f6">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="st">"data/02/gapminder_tsv.txt"</span>, n_max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country\tcontinent\tyear\tlifeExp\tpop\tgdpPercap"    
[2] "Afghanistan\tAsia\t1952\t28.801\t8425333\t779.4453145"
[3] "Afghanistan\tAsia\t1957\t30.332\t9240934\t820.8530296"</code></pre>
</div>
</div>
<p>We notice that the values are separated by “, a special sequence that stands for the tab character. The <code>read_tsv</code> function will do the job. I am not showing the output here because it is just the gapminder dataset once again.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-11_b1ae4f263defaf618ea6263c2c8993e3">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="st">"data/02/gapminder_tsv.txt"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the separator (also called delimiter) is even more obscure, we can use the general function <code>read_delim</code>. Say a co-worker misunderstood us and thought tsv stands for “Tilde separated values”, we can still read his file.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-12_c3c94d715e717cc4cf697a95835bdeba">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">"data/02/obscure_file.tsv"</span>, <span class="st">"~"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are more ways in which raw data can be messy or hard to read depending on the machine but I can’t show all of them. One common thing you will encounter though is measurement machines writing some additional information in the first couple of lines before the actual data (like the time of the measurement). In this example:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-13_794e994b02793c5bd96cffb9e7aece41">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="st">"data/02/gapminder_messier.csv"</span>, n_max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "# Some comment about the data"                   
[2] "And maybe a personal note"                       
[3] "country,continent,year,lifeExp,pop,gdpPercap"    
[4] "Afghanistan,Asia,1952,28.801,8425333,779.4453145"
[5] "Afghanistan,Asia,1957,30.332,9240934,820.8530296"</code></pre>
</div>
</div>
<p>The first 2 lines are not part of the data. Reading the file normally as a csv would produce something weird: Because the first line does not contain any commata, it will assume that the file contains only one column and also report a bunch of <strong>parsing failures</strong>. Parsing is the act of turning data represented as raw text into a useful format, like a table of numbers.</p>
<p>We can fix this by telling R to skip the first 2 lines entirely:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-14_c3efd9f13f4417b0425c79e83871c817">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/02/gapminder_messier.csv"</span>, skip <span class="op">=</span> <span class="fl">2</span>, n_max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  country     continent  year lifeExp      pop gdpPercap
  &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Afghanistan Asia       1952    28.8  8425333      779.
2 Afghanistan Asia       1957    30.3  9240934      821.
3 Afghanistan Asia       1962    32.0 10267083      853.</code></pre>
</div>
</div>
<p>I was using the <code>n_max</code> argument of the functions above to save space in this lecture script.</p>
<p>We can also read excel files it using a function from the <code>readxl</code> package. This package is automatically installed with the tidyverse, but it is not loaded along with the other packages via <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>. We can either load it with <code><a href="https://readxl.tidyverse.org">library(readxl)</a></code> or refer to a single function from the package without loading the whole thing using double colons (<code>::</code>) like so:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-15_ae7f22c02792285819e61892107e3618">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"data/02/gapminder.xlsx"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>Remember, that when we read in the gapminder dataset for the first time to day, we saved it in a variable called <code>gapminder</code>, so we are going to use this going forward.</p>
</section></section><section id="wrangling-data-with-dplyr" class="level2 page-columns page-full" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="wrangling-data-with-dplyr">
<span class="header-section-number">2.4</span> Wrangling Data with <code>dplyr</code>
</h2>
<aside><p><a href="https://dplyr.tidyverse.org/"> <img src="images/dplyr.png" class="img-fluid"></a></p>
</aside><p>There a are a number of ways in which we can manipulate data. Of course I mean manipulate in it’s original sense, not the malicious one. This is sometimes referred to as <strong>data wrangling</strong> and within the tidyverse, this is a job for the <code>dplyr</code> package (short for data plyer, the tool you see in the logo).</p>
<p>dplyr provides functions for various operations on our data. Theses functions are sometimes also called <strong>dplyr verbs</strong>. All of them take a <code>tibble</code> or <code>data.frame</code> as input (plus additional parameters) and always return a <code>tibble</code>. But enough talk, let’s go wrangling!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/dplyr_wrangling.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Let’s go data wrangling! Artwork by Allison Horst</figcaption><p></p>
</figure>
</div>
<section id="select" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="select">
<span class="header-section-number">2.4.1</span> select</h3>
<p>The first verb we introduce is used to select columns. And hence, it is called <code>select</code>. The first argument is always the data, followed by an arbitrary number of column names. We can recognize functions the take an arbitrary number of additional arguments by the <code>...</code> in the autocompletion and help page.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-16_02e7549ba6ee5289b763752d4e21e94e">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span>, <span class="va">year</span>, <span class="va">gdpPercap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 3
   country      year gdpPercap
   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan  1952      779.
 2 Afghanistan  1957      821.
 3 Afghanistan  1962      853.
 4 Afghanistan  1967      836.
 5 Afghanistan  1972      740.
 6 Afghanistan  1977      786.
 7 Afghanistan  1982      978.
 8 Afghanistan  1987      852.
 9 Afghanistan  1992      649.
10 Afghanistan  1997      635.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>It might be confusing why we don’t need quotation marks around the column names like we do in other languages or even other parts of R.</p>
<p>This concept is known as <strong>quasiquotation</strong> or <strong>data masking</strong>. It is quite unique to R, but it allows functions to known about the content of the data that is passed to them and use this as the environment in which they do their computations and search for variable names. So while the variable <code>country</code> doesn’t exist in the global environment, it does exist as a column of the gapminder tibble.</p>
<blockquote class="blockquote">
<p><code>dplyr</code> functions always look in the data first when they search for names.</p>
</blockquote>
<p>The help page for <code>select</code> tells us more about the different ways in which we can select columns. Here are a couple of examples without the output, run them in your R session to confirm that they do what you think they do (but do have a look at the help pages yourselves, they are quite well written).</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-17_2d943f04fc3318743a0e0339a954160f">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span><span class="op">:</span><span class="va">pop</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"co"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="filter" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="filter">
<span class="header-section-number">2.4.2</span> filter</h3>
<p>After selecting columns it is only natural to ask how to select rows. This is achieved with the function <code>filter</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/dplyr_filter.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Filter data. Artwork by Allison Horst</figcaption><p></p>
</figure>
</div>
<p>Here, we select all rows, where the year is greater than 2000 and the country is New Zealand.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-18_d4a5e7fe0cc5d9a7bfb9b6cb0995e363">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2000</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"New Zealand"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because text comparisons are cases sensitive, we would have missed New Zealand had we written it with lowercase letters. In order to make sure we find the correct country, it can be helpful to simply convert all country names to lower case, and in fact we can use functions on our columns straight inside of any dplyr verb. Functions that deal with text (strings or character in R’s language) in the tidyverse start with <code>str_</code>, so they are easy to find with autocompletion.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-19_ddee8a56709e240d2702f6a6f6190cab">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2000</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">==</span> <span class="st">"new zealand"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Instead of combining conditions with <code>,</code> (which works the same as <code>&amp;</code> here), we can also use <code>|</code> meaning <strong>or</strong>. Here, we get all rows where the country is New Zealand or the country is Afghanistan.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-20_aeb6c4b0e6b14d61ca92fa916228a02b">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"New Zealand"</span> <span class="op">|</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Afghanistan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This particular comparison can be written more succinctly, by asking (for every row), is the particular country <code>%in%</code> this vector?</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-21_80170dfb84af55a0c4e794ad6c5867e3">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"New Zealand"</span>, <span class="st">"Afghanistan"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="mutate" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="mutate">
<span class="header-section-number">2.4.3</span> mutate</h3>
<p>We are back at manipulating columns, this time by creating new ones or changing old ones. The <code>dplyr</code> verb that does that is called <code>mutate</code>. For example, we might want to calculate the total GDP from the GDP per Capita and the population:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-22_055800f2e15e1a2a266cc6a8e3c19cf6">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">gapminder</span>, gdp <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 7
   country     continent  year lifeExp      pop gdpPercap          gdp
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.
 2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.
 3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.
 4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.
 5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.
 6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.
 7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.
 8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.
 9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.
10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>Notice, that none of the functions changed the original variable <code>gapminder</code>. They only take an input and return and output, which makes it easier to reason about our code and later chain pieces of code together. How do you change it then? Use the Force! … ahem, I mean, the assignment operator (<code>&lt;-</code>).</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-23_9850bfe4168181a2a9d6d551a8bb1a3f">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">gapminder</span>, gdp <span class="op">=</span> <span class="va">pop</span> <span class="op">*</span> <span class="va">gdpPercap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the power of dplyr shines. It knows that <code>pop</code> and <code>gdpPercap</code> are columns of the tibble and that <code>gdp</code> refers to the new name of the freshly created column.</p>
</section><section id="interlude-begind-the-magic-handling-data-with-base-r" class="level3" data-number="2.4.4"><h3 data-number="2.4.4" class="anchored" data-anchor-id="interlude-begind-the-magic-handling-data-with-base-r">
<span class="header-section-number">2.4.4</span> Interlude: Begind the magic, handling data with base-R</h3>
<p>This section is meant to show you what happens behind the scenes. It is not strictly necessary to understand all the details of it in order to work effectively with the tidyverse, but it helps especially when things don’t go as planned.</p>
<p>Let’s create a tibble to play with:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-24_ae08e9f160b54df6a4333084602219bf">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  y <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span>, <span class="st">"test"</span>, <span class="st">"four"</span>, <span class="st">"five"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
      x     y z    
  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     1 hello
2     2     4 world
3     3     9 test 
4     4    16 four 
5     5    25 five </code></pre>
</div>
</div>
<p>Instead of the tidyverse functions, we can also use what is called <strong>subsetting</strong>, getting a subset of our datasctructure, with square brackets:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-25_75071917e336d45a61b7859825ef45ba">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
      x z    
  &lt;int&gt; &lt;chr&gt;
1     1 hello
2     2 world
3     3 test 
4     4 four 
5     5 five </code></pre>
</div>
</div>
<p>This selected the first and third column. This also works for lone vectors:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-26_c4661d95a68ed37cf4e9b6115de85f11">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">evens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">evens</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 4</code></pre>
</div>
</div>
<p>If we want to select columns by their names without the tidyverse, we have to pass these names as a character vector (hence the quotation marks).</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-27_b4cf7a0ae18a59e12b52ec708218fe47">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"z"</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
      x z    
  &lt;int&gt; &lt;chr&gt;
1     1 hello
2     2 world
3     3 test 
4     4 four 
5     5 five </code></pre>
</div>
</div>
<p>If we have two things in the square brackets, separated by a comma, the first refers to the rows and the second refers to the columns. e.g.&nbsp;this would be “the first row and the columns from 1 to 2”:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-28_7a7c83bbbabbe9a88c8e95d6faa30558">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
      x     y
  &lt;int&gt; &lt;dbl&gt;
1     1     1</code></pre>
</div>
</div>
<p>Internally, tibbles / dataframes are lists of columns. Lists have more ways of accessing their elements. The <code>$</code> symbol gets us an element from the list:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-29_c5a9eedcc50df0a955b990eac7b3660a">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span><span class="op">$</span><span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>If we want to use numbers (=indices) to get a single element from a list (or a column from a tibble), we have ot use double square brackets:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-30_72d2cc33726b8616a5ee67c46cf21c75">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test_tibble</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>The reason for this: Single square brackets give us a subset of the list, which is still packed up in a list. If we want to unpack it to work with it we need the content of just one element <code>[[</code> does that for us.</p>
<p>The <code>pull</code> function from the tidyverse works like <code>$</code>.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-31_7033026904c83c4345d39e869d8b6062">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">test_tibble</span>, <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>Subsetting not only works for looking at things, it also allows us to replace the part we are subsetting:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-32_560cc9172c23cd217662958ce149e2d3">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">42</span></span>
<span><span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 42  2  3  4  5  6  7  8  9 10</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Note:<br>
The base-R and the tidyverse way are not mutually exclusive. Sometimes you can mix and match.</p>
</blockquote>
</section><section id="the-pipe" class="level3" data-number="2.4.5"><h3 data-number="2.4.5" class="anchored" data-anchor-id="the-pipe">
<span class="header-section-number">2.4.5</span> The pipe <code>%&gt;%</code>
</h3>
<p>The tidyverse functions are easier to compose (i.e.&nbsp;chain together). To facilitate this, we introduce another operator, a bit like <code>+</code> for numbers or the <code>+</code> to add ggplot components, but specially for functions. The pipe, which you can either type or insert in RStudio with <strong>Ctrl+Shift+M</strong>, takes it’s left side and passes it as the first argument to the function on the right side</p>
<p>Why is this useful? Imagine our data processing involves a bunch of steps, so we save the output to intermediate variables.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-33_9383995d5f6292b495127f2903dcea62">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">subset_gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gapminder</span>, <span class="va">country</span>, <span class="va">year</span>, <span class="va">pop</span><span class="op">)</span></span>
<span><span class="va">filtered_gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">subset_gapminder</span>, <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">final_gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">filtered_gapminder</span>, pop_thousands <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">final_gapminder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 4
   country      year      pop pop_thousands
   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan  1952  8425333         8425.
 2 Afghanistan  1957  9240934         9241.
 3 Afghanistan  1962 10267083        10267.
 4 Afghanistan  1967 11537966        11538.
 5 Afghanistan  1972 13079460        13079.
 6 Afghanistan  1977 14880372        14880.
 7 Afghanistan  1982 12881816        12882.
 8 Afghanistan  1987 13867957        13868.
 9 Afghanistan  1992 16317921        16318.
10 Afghanistan  1997 22227415        22227.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>However, we don’t really need those intermediate variables and they just clutter our code. The pip allows us to express our data processing as a series of steps:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-34_277927eb26c228accefb1eb415d4ac2a">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_gapminder</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">pop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pop_thousands <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final_gapminder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 284 × 4
   country      year      pop pop_thousands
   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan  2002 25268405        25268.
 2 Afghanistan  2007 31889923        31890.
 3 Albania      2002  3508512         3509.
 4 Albania      2007  3600523         3601.
 5 Algeria      2002 31287142        31287.
 6 Algeria      2007 33333216        33333.
 7 Angola       2002 10866106        10866.
 8 Angola       2007 12420476        12420.
 9 Argentina    2002 38331121        38331.
10 Argentina    2007 40301927        40302.
# … with 274 more rows</code></pre>
</div>
</div>
<p>You can read the pipe in your head as “and then” or “take … pass it into …”.</p>
<p>And because all main <code>tidyverse</code> functions take data as their first argument, we can chain them together fluently Additionally, it enables autocompletion of column names inside of the function that gets the data.</p>
<p>Next to the tidyverse pipe <code>%&gt;%</code>, you might also see <code>|&gt;</code> at some point. The latter is a pipe that was introduced to base-R because this whole piping thing got so popular they are making it part of the core language.</p>
</section><section id="arrange" class="level3" data-number="2.4.6"><h3 data-number="2.4.6" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">2.4.6</span> arrange</h3>
<p>A simple thing you might want from a table is to sort it based on some column. This is what <code>arrange</code> does:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-35_8247e28b575ef36369906af9253efcca">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 7
   country     continent  year lifeExp      pop gdpPercap           gdp
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.   6567086330.
 2 Albania     Europe     1952    55.2  1282697     1601.   2053669902.
 3 Algeria     Africa     1952    43.1  9279525     2449.  22725632678.
 4 Angola      Africa     1952    30.0  4232095     3521.  14899557133.
 5 Argentina   Americas   1952    62.5 17876956     5911. 105676319105.
 6 Australia   Oceania    1952    69.1  8691212    10040.  87256254102.
 7 Austria     Europe     1952    66.8  6927772     6137.  42516266683.
 8 Bahrain     Asia       1952    50.9   120447     9867.   1188460759.
 9 Bangladesh  Asia       1952    37.5 46886859      684.  32082059995.
10 Belgium     Europe     1952    68    8730405     8343.  72838686716.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>The helper function <code>desc</code> marks a column to be arranged in descending order. We can arrange by multiple columns, where the first will be most important.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-36_6e4b829c58642ceb7dac4729b1659ee4">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">pop</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 7
   country               continent  year lifeExp     pop gdpPercap          gdp
   &lt;chr&gt;                 &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
 1 Sao Tome and Principe Africa     2007    65.5  199579     1598.   319014077.
 2 Iceland               Europe     2007    81.8  301931    36181. 10924101861.
 3 Djibouti              Africa     2007    54.8  496374     2082.  1033689705.
 4 Equatorial Guinea     Africa     2007    51.6  551201    12154.  6699346424.
 5 Montenegro            Europe     2007    74.5  684736     9254.  6336475807.
 6 Bahrain               Asia       2007    75.6  708573    29796. 21112675360.
 7 Comoros               Africa     2007    65.2  710960      986.   701111696.
 8 Reunion               Africa     2007    76.4  798094     7670.  6121478793.
 9 Trinidad and Tobago   Americas   2007    69.8 1056608    18009. 19027934931.
10 Swaziland             Africa     2007    39.6 1133066     4513.  5114071458.
# … with 1,694 more rows</code></pre>
</div>
</div>
</section><section id="summarise" class="level3" data-number="2.4.7"><h3 data-number="2.4.7" class="anchored" data-anchor-id="summarise">
<span class="header-section-number">2.4.7</span> summarise</h3>
<p>To condense one or multiple columns into summary values, we use <code>summarise</code>. Like with mutate, we can calculate multiple things in one step.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-37_a0700cce849cded7ba5cbf8351ac8f40">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    max_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    mean_life_expectancy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  max_year        pop mean_life_expectancy
     &lt;dbl&gt;      &lt;dbl&gt;                &lt;dbl&gt;
1     1952 1318683096                 59.5</code></pre>
</div>
</div>
<p>But condensing whole columns into one value, flattening the tibble in the style of Super Mario jumping on mushrooms, is often not what we need. We would rather know the summaries within certain groups. For example the maximal gdp <strong>per country</strong>. This is what <code>group_by</code> is for.</p>
</section><section id="group_by" class="level3" data-number="2.4.8"><h3 data-number="2.4.8" class="anchored" data-anchor-id="group_by">
<span class="header-section-number">2.4.8</span> group_by</h3>
<p><code>group_by</code> is considered an adverb, because it doesn’t change the data itself but it changes how subsequent functions handle the data. For example, if a tibble has groups, all summaries are calculated within these groups:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-38_178e04f566c16ce801de3757b1322802">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
    year lifeExp
   &lt;dbl&gt;   &lt;dbl&gt;
 1  1952    49.1
 2  1957    51.5
 3  1962    53.6
 4  1967    55.7
 5  1972    57.6
 6  1977    59.6
 7  1982    61.5
 8  1987    63.2
 9  1992    64.2
10  1997    65.0
11  2002    65.7
12  2007    67.0</code></pre>
</div>
</div>
<p><code>summarize</code> removes one level of grouping. If the data was grouped by multiple features, this means that some groups remain. We can make sure that the data is no longer grouped with <code>ungroup</code>.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-39_4ef52ed8cc8904a83dda5ce11f6b909d">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 3
    year continent lifeExp
   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
 1  1952 Africa       39.1
 2  1952 Americas     53.3
 3  1952 Asia         46.3
 4  1952 Europe       64.4
 5  1952 Oceania      69.3
 6  1957 Africa       41.3
 7  1957 Americas     56.0
 8  1957 Asia         49.3
 9  1957 Europe       66.7
10  1957 Oceania      70.3
# … with 50 more rows</code></pre>
</div>
</div>
<p>Groups also work within <code>mutate</code> and <code>filter</code>. For example, we can get all rows where the gdp per Person was highest per country:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-40_0185970c07fb4cb551174b23913a944a">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gdpPercap</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 7
# Groups:   country [142]
   country     continent  year lifeExp       pop gdpPercap           gdp
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Afghanistan Asia       1982    39.9  12881816      978.  12598563401.
 2 Albania     Europe     2007    76.4   3600523     5937.  21376411360.
 3 Algeria     Africa     2007    72.3  33333216     6223. 207444851958.
 4 Angola      Africa     1967    36.0   5247469     5523.  28980597822.
 5 Argentina   Americas   2007    75.3  40301927    12779. 515033625357.
 6 Australia   Oceania    2007    81.2  20434176    34435. 703658358894.
 7 Austria     Europe     2007    79.8   8199783    36126. 296229400691.
 8 Bahrain     Asia       2007    75.6    708573    29796.  21112675360.
 9 Bangladesh  Asia       2007    64.1 150448339     1391. 209311822134.
10 Belgium     Europe     2007    79.4  10392226    33693. 350141166520.
# … with 132 more rows</code></pre>
</div>
</div>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-41_f8c6eb15143b9766889098dce7f4f24f">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 7
# Groups:   year [12]
   country     continent  year lifeExp     pop gdpPercap          gdp
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8 0.00350      779.  6567086330.
 2 Afghanistan Asia       1957    30.3 0.00347      821.  7585448670.
 3 Afghanistan Asia       1962    32.0 0.00354      853.  8758855797.
 4 Afghanistan Asia       1967    34.0 0.00359      836.  9648014150.
 5 Afghanistan Asia       1972    36.1 0.00366      740.  9678553274.
 6 Afghanistan Asia       1977    38.4 0.00379      786. 11697659231.
 7 Afghanistan Asia       1982    39.9 0.00300      978. 12598563401.
 8 Afghanistan Asia       1987    40.8 0.00296      852. 11820990309.
 9 Afghanistan Asia       1992    41.7 0.00319      649. 10595901589.
10 Afghanistan Asia       1997    41.8 0.00403      635. 14121995875.
# … with 1,694 more rows</code></pre>
</div>
</div>
</section><section id="others" class="level3" data-number="2.4.9"><h3 data-number="2.4.9" class="anchored" data-anchor-id="others">
<span class="header-section-number">2.4.9</span> others:</h3>
<p>We can rename columns with <code>rename</code>:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-42_a3f3cd4d033638e8b9ff098971294ce2">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>population <span class="op">=</span> <span class="va">pop</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 7
   country     continent  year lifeExp population gdpPercap          gdp
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8    8425333      779.  6567086330.
 2 Afghanistan Asia       1957    30.3    9240934      821.  7585448670.
 3 Afghanistan Asia       1962    32.0   10267083      853.  8758855797.
 4 Afghanistan Asia       1967    34.0   11537966      836.  9648014150.
 5 Afghanistan Asia       1972    36.1   13079460      740.  9678553274.
 6 Afghanistan Asia       1977    38.4   14880372      786. 11697659231.
 7 Afghanistan Asia       1982    39.9   12881816      978. 12598563401.
 8 Afghanistan Asia       1987    40.8   13867957      852. 11820990309.
 9 Afghanistan Asia       1992    41.7   16317921      649. 10595901589.
10 Afghanistan Asia       1997    41.8   22227415      635. 14121995875.
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>Sometimes you want to refer to the size of the current group inside of <code>mutate</code> or <code>summarise</code>. The function to to just that is called <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>. For example, I wonder how many rows of data we have per year.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-43_b013ffd61afe84507f67757e7507625c">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,704 × 8
# Groups:   year [12]
   country     continent  year lifeExp      pop gdpPercap          gdp     n
   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.   142
 2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.   142
 3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.   142
 4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.   142
 5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.   142
 6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.   142
 7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.   142
 8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.   142
 9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.   142
10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.   142
# … with 1,694 more rows</code></pre>
</div>
</div>
<p>A shortcut for <code>group_by</code> and <code>summarise</code> with <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> is the <code>count</code> function:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-44_b829ac493bfa9ca430b4040d8805de3d">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
      n    nn
  &lt;int&gt; &lt;int&gt;
1     1  1704</code></pre>
</div>
</div>
<p>In general, you might find after solving a particular problem in a couple of steps that there is a more elegant solution. Do not be discouraged by that! It simply means that there is always more to learn, but the tools you already know by now will get you a very long way and set you on the right track.</p>
<p>I think we learned enough dplyr verbs for now. We can treat ourselves to a little ggplot visualization.</p>
</section></section><section id="visualization-and-our-first-encounter-with-factors" class="level2 page-columns page-full" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="visualization-and-our-first-encounter-with-factors">
<span class="header-section-number">2.5</span> Visualization and our first encounter with <code>factor</code>s</h2>
<aside><p><a href="https://forcats.tidyverse.org/"> <img src="images/forcats.png" class="img-fluid"></a></p>
</aside><div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-45_6b423a838e1741fe3429e908f0a3d7f0">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>, group <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="data-wrangling_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>The <code>facet_wrap</code> function slices our plot into theses subplots, a style of plot sometimes referred to as <em>small multiples</em>. At this point you might wonder: “How do I control the order of these facets?” The answer is: With a <code>factor</code>!</p>
<p>Any time we have a vector that can be thought of as representing discrete categories (ordered or unordered), we can express this by turning the vector into a factor with the <code>factor</code> function. This enables R’s functions to handle them appropriately. Let’s create a little example. We start out with a character vector.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-46_9bd3b58185d7af4e742362a26f0b07e3">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"bear"</span>, <span class="st">"shark"</span><span class="op">)</span></span>
<span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">animals</span><span class="op">)</span></span>
<span><span class="va">animals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] cat   dog   bear  shark
Levels: bear cat dog shark</code></pre>
</div>
</div>
<p>Note the new information R gives us, the <strong>Levels</strong>, which is all possible values we can put into the factor. They are automatically ordered alphabetically on creation. We can also pass a vector of levels on creation.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-47_2a9b1fbad812ad74ee9067545227c5e6">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"bear"</span>, <span class="st">"shark"</span><span class="op">)</span></span>
<span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">animals</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">animals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] cat  dog  &lt;NA&gt; &lt;NA&gt;
Levels: cat &lt; dog</code></pre>
</div>
</div>
<p>A factor can only contain elements that are in the levels, so because I omitted the whale shark, it will be turned into <code>NA</code>. The tidyverse contains the <code>forcats</code> package to help with factors. Most functions from this package start with <code>fct_</code>.</p>
<p>For example, the <code>fct_relevel</code> function, which keeps all levels but let’s us change the order:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-48_89763e669492a6c829e0b9b9d257b1bb">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"bear"</span>, <span class="st">"shark"</span><span class="op">)</span></span>
<span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">animals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">animals</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"shark"</span>, <span class="st">"dog"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] cat   dog   bear  shark
Levels: shark dog bear cat</code></pre>
</div>
</div>
<p>Using this in action, we get:</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-49_6c5df375be8265054f8efb5bb4277845">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">continent</span>, <span class="st">"Oceania"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>, group <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="data-wrangling_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>Note: <code>fct_relevel</code> might be a very constructed example. More often you will need its cousin <code>fct_reoder</code> to reorder a factor by the values of some other column.</p>
<p>Let’s make this plot a bit prettier by adding color! The <code>gapminder</code> package that provided this dataset also included a nice color palette. I included it as a <code>.csv</code> file in the <code>data/</code> folder so that we can practice importing data once more. But you could also take the shortcut of getting it straight from the package (<code><a href="https://rdrr.io/pkg/gapminder/man/country_colors.html">gapminder::country_colors</a></code>). Here, we are using the <code>head</code> function to look at the first couple of rows of the tibble and to look at the first couple of elements of the named vector from the package.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-50_e1ce806e66ae13dc21e85e205b80aa78">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">country_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/02/country_colors.csv"</span><span class="op">)</span></span>
<span><span class="va">color</span> <span class="op">&lt;-</span> <span class="va">country_colors</span><span class="op">$</span><span class="va">color</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">country_colors</span><span class="op">$</span><span class="va">country</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Nigeria            Egypt         Ethiopia Congo, Dem. Rep. 
       "#7F3B08"        "#833D07"        "#873F07"        "#8B4107" 
    South Africa            Sudan 
       "#8F4407"        "#934607" </code></pre>
</div>
</div>
<p>Having a named vector means that we can access individual elements by their names, and ggplot can use those names to match up for example colors with countries when we pass it to a <code>scale_</code> function.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-51_4bbc9da842506a164c5b67b98b692cec">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>first <span class="op">=</span> <span class="fl">1</span>, second <span class="op">=</span> <span class="fl">3</span>, hello <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="st">"first"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>first 
    1 </code></pre>
</div>
</div>
<p>To the final plot we also add <code>guides(color = "none")</code>, because if we were to show a guide (for discrete colors typically a legend), it would fill up the whole plot.</p>
<div class="cell" data-hash="data-wrangling_cache/html/unnamed-chunk-52_3ec860ae6a2fc5a798421afb87c933f7">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">continent</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Oceania"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">color</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="data-wrangling_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section><section id="exercises" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">2.6</span> Exercises</h2>
<ul>
<li>Drink a cup of coffee or tea, relax, because you just worked through quite a long video.</li>
<li>Familiarize yourself with the folders on your computer. Make sure you understand, where your directories and files live.</li>
<li>Download the data for today in one of the ways taught. You can refer to the script anytime.</li>
<li>The file <code>./data/02/exercise1.txt</code> is in an unfamiliar format.
<ul>
<li>Find out how it is structured and read it in with <code>readr</code>.</li>
<li>Create a scatterplot of the x and y column with <code>ggplot</code>.</li>
<li>Look at the help page for <code>geom_point</code>. What is the difference between <code>geom_point(aes(color = &lt;something&gt;))</code> and <code>geom_point(color = &lt;something&gt;)</code>? A relevant hint is in the section about the <code>...</code>-argument.</li>
<li>Make the plot pretty by coloring the points, keeping in mind the above distinction.</li>
</ul>
</li>
<li>Read in the <code>gapminder</code> dataset with <code>readr</code>
<ul>
<li>Using a combination of <code>dplyr</code> verbs and / or visualizations with <code>ggplot</code>, answer the following questions:</li>
<li>Which continent had the highest life expectancy on average in the most current year? There are two options here. First, calculate a simple mean for the countries in each continent. Then, remember that the countries have different population sizes, so we really need a <em>weighted mean</em> using R’s function <code><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean()</a></code>.</li>
<li>Is there a relationship between the GDP per capita and the life expectancy? A visualization might be helpful.</li>
<li>How did the population of the countries change over time? Make the plot more informative by adding color, facets and labels (with <code>geom_text</code>). Can you find out, how to add the country name label only to the last year? Hint: Have a look at the <code>data</code> argument that all <code>geom_</code>-functions have.</li>
</ul>
</li>
</ul></section><section id="resources" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="resources">
<span class="header-section-number">2.7</span> Resources</h2>
<p>Don’t miss the dedicated <a href="@sec-resources">Resources</a> page.</p>
<section id="package-documentation" class="level3" data-number="2.7.1"><h3 data-number="2.7.1" class="anchored" data-anchor-id="package-documentation">
<span class="header-section-number">2.7.1</span> Package Documentation</h3>
<ul>
<li><a href="https://www.tidyverse.org/">The tidyverse website</a></li>
<li><a href="https://readr.tidyverse.org/">The readr package website with cheatsheet</a></li>
<li><a href="https://dplyr.tidyverse.org/">The dplyr package website with cheatsheet</a></li>
</ul></section><section id="getting-help" class="level3" data-number="2.7.2"><h3 data-number="2.7.2" class="anchored" data-anchor-id="getting-help">
<span class="header-section-number">2.7.2</span> Getting Help</h3>
<ul>
<li><a href="https://www.tidyverse.org/help/#reprex">How to find help</a></li>
<li><a href="https://www.rfordatasci.com/">R4DS online learning community</a></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-bryanGapminderDataGapminder2017" class="csl-entry" role="doc-biblioentry">
Bryan, Jennifer. 2017. <em>Gapminder: <span>Data</span> from Gapminder</em>. Manual.
</div>
<div id="ref-wickhamDataScienceImport2017" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for <span>Data Science</span>: <span>Import</span>, <span>Tidy</span>, <span>Transform</span>, <span>Visualize</span>, and <span>Model Data</span></em>. 1 edition. <span>Sebastopol, CA</span>: <span>O’Reilly Media</span>.
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./tidy-data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tidy data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>