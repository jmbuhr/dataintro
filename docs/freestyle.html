<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lesson 8 Freestyle | Introduction to Data Analysis with R</title>
<meta name="author" content="Jannik Buhr">
<meta name="description" content="… in which we learn about ANOVA, explore ggplot extensions and build and interactive web application with Shiny.    8.1 Setup Today we are using quite a bunch of packages. In the lecture these are...">
<meta name="generator" content="bookdown 0.24.2 with bs4_book()">
<meta property="og:title" content="Lesson 8 Freestyle | Introduction to Data Analysis with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://jmbuhr.de/dataintro/freestyle.html">
<meta property="og:description" content="… in which we learn about ANOVA, explore ggplot extensions and build and interactive web application with Shiny.    8.1 Setup Today we are using quite a bunch of packages. In the lecture these are...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lesson 8 Freestyle | Introduction to Data Analysis with R">
<meta name="twitter:description" content="… in which we learn about ANOVA, explore ggplot extensions and build and interactive web application with Shiny.    8.1 Setup Today we are using quite a bunch of packages. In the lecture these are...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><script src="libs/twitter-widget-0.0.1/widgets.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction to Data Analysis with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Hello and welcome!</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">2</span> Data Wrangling</a></li>
<li><a class="" href="tidy-data.html"><span class="header-section-number">3</span> Tidy data</a></li>
<li><a class="" href="functional-programming.html"><span class="header-section-number">4</span> Functional Programming</a></li>
<li><a class="" href="probability-and-hypothesis-testing.html"><span class="header-section-number">5</span> Probability and Hypothesis Testing</a></li>
<li><a class="" href="distributions-summaries-and-dimensionality-reduction.html"><span class="header-section-number">6</span> Distributions, Summaries and Dimensionality Reduction</a></li>
<li><a class="" href="fallacies-correlation-and-regression.html"><span class="header-section-number">7</span> Fallacies, Correlation and Regression</a></li>
<li><a class="active" href="freestyle.html"><span class="header-section-number">8</span> Freestyle</a></li>
<li><a class="" href="resources-5.html">Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jmbuhr/dataintro">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="freestyle" class="section level1" number="8">
<h1>
<span class="header-section-number">Lesson 8</span> Freestyle<a class="anchor" aria-label="anchor" href="#freestyle"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p>… in which we learn about ANOVA, explore ggplot extensions and
build and interactive web application with Shiny.</p>
</blockquote>
<div class="video-container">
<iframe class="video" src="https://www.youtube.com/embed/gZ0u6b_1ej4?vq=hd1080" allowfullscreen>
</iframe>
</div>
<div id="setup-1" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Setup<a class="anchor" aria-label="anchor" href="#setup-1"><i class="fas fa-link"></i></a>
</h2>
<p>Today we are using quite a bunch of packages.
In the lecture these are of course introduced one by one,
but because it is a good habit to have all your imports
and dependencies near the top of your analysis they
show up here already.</p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org">multcomp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="anova" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> ANOVA<a class="anchor" aria-label="anchor" href="#anova"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s get started.
ANOVA stands for Analysis of Variance.
We start with our familiar penguins dataset and ask
the question: “Is there a difference in bill length between the species?”</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-2-1.png" width="100%"></div>
<p>Optically, it certainly looks like it.
We could run a bunch of t-tests to compare between the groups,
which would be 3 in total (Adelie–Chinstrap, Adelie–Gentoo, Gentoo–Chinstrap).
And then we would have to correct for multiple testing.
At this point, only running one of tests (like Adelie vs. Chinstrap)
because it looks so promising is not an option!
Looking at the data visually is a form of comparison,
so we would be cheating if we formed our hypothesis only after
looking at the data.</p>
<p><strong>ANOVA</strong> is a way of comparing multiple groups and tells us, if there
is a difference at all between the groups.
It does not however tell us, between which groups the difference exists,
just that there is an overall difference.
In order to get p-values for direct comparisons between the groups
we run a <strong>post-hoc</strong> (Latin for “after the fact”) on our anova result.</p>
<p>First I am sliding in a little extra code chunk, because later down
the line we might want to compare all groups to e.g. a baseline or
control group (see the section about Dunnet below) and this baseline
is decided to be the first factor-level of the grouping variable.
With <code>fct_relevel</code> we can move a lovel to the first (or any other)
position.</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"Gentoo"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Not we create an anova fit with <code>aov</code>.</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anova_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span>
<span class="va">anova_fit</span></code></pre></div>
<pre><code>Call:
   aov(formula = bill_length_mm ~ species, data = penguins)

Terms:
                 species Residuals
Sum of Squares  7194.317  2969.888
Deg. of Freedom        2       339

Residual standard error: 2.959853
Estimated effects may be unbalanced
2 observations deleted due to missingness</code></pre>
<p>And explore if further with various functions.</p>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">anova_fit</span><span class="op">)</span></code></pre></div>
<pre><code>             Df Sum Sq Mean Sq F value Pr(&gt;F)    
species       2   7194    3597   410.6 &lt;2e-16 ***
Residuals   339   2970       9                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
2 observations deleted due to missingness</code></pre>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">anova_fit</span><span class="op">)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sumsq"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["meansq"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"species","2":"2","3":"7194.317","4":"3597.158720","5":"410.6003","6":"2.694614e-91"},{"1":"Residuals","2":"339","3":"2969.888","4":"8.760732","5":"NA","6":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="tukey-post-hoc-test" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">8.2.1</span> Tukey Post-Hoc Test<a class="anchor" aria-label="anchor" href="#tukey-post-hoc-test"><i class="fas fa-link"></i></a>
</h3>
<p>The most straighforward post-hoc test, which is already built into R,
is “Tukey’s Honest Significant Differences,”
which compares all groups with all other groups.</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/TukeyHSD.html">TukeyHSD</a></span><span class="op">(</span><span class="va">anova_fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["contrast"],"name":[2],"type":["chr"],"align":["left"]},{"label":["null.value"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["adj.p.value"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"species","2":"Adelie-Gentoo","3":"0","4":"-8.713487","5":"-9.5597807","6":"-7.867194","7":"0.000000000"},{"1":"species","2":"Chinstrap-Gentoo","3":"0","4":"1.328945","5":"0.2760231","6":"2.381868","7":"0.008899333"},{"1":"species","2":"Chinstrap-Adelie","3":"0","4":"10.042433","5":"9.0248592","6":"11.060006","7":"0.000000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="dunnet-post-hoc-test" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">8.2.2</span> Dunnet Post-Hoc Test<a class="anchor" aria-label="anchor" href="#dunnet-post-hoc-test"><i class="fas fa-link"></i></a>
</h3>
<p>If we have a control group we use Dunnet’s test to compare all other
groups to the control group.
This means we have to do less comparisons and end up with a higher statistical power.</p>
<p>Unfortunately, Dunnet is not built into R, but we can get the necessary
functions from the <code>multcomp</code> package.
When loading the <code>multcomp</code> package we have to be careful
to load it before the <code>tidyverse</code>!
Because <code>multcomp</code> also loads a bunch of other packages and one
of them brings it’s own <code>select</code> function, so loading it after
the <code>tidyverse</code> would overwrite tidyverse <code>select</code> and make our life very hard.</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span><span class="va">anova_fit</span>, <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Dunnet"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["contrast"],"name":[2],"type":["chr"],"align":["left"]},{"label":["null.value"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["adj.p.value"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"species","2":"Adelie - Gentoo","3":"0","4":"-8.713487","5":"0.3595046","6":"-24.237485","7":"-4.440892e-16","_row":"Adelie - Gentoo"},{"1":"species","2":"Chinstrap - Gentoo","3":"0","4":"1.328945","5":"0.4472804","6":"2.971169","7":"6.201777e-03","_row":"Chinstrap - Gentoo"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note, that this package can also do Tukey’s test by changing “Dunnet”
to “Tukey.”</p>
</div>
</div>
<div id="ggplot-extensions" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> ggplot extensions<a class="anchor" aria-label="anchor" href="#ggplot-extensions"><i class="fas fa-link"></i></a>
</h2>
<p>In order to plot these nice significance stars on top of of our
comparisons let me first introduce you to ggplot extensions:</p>
<p><a href="https://exts.ggplot2.tidyverse.org/" class="uri">https://exts.ggplot2.tidyverse.org/</a></p>
<p>This is just a collection of packages that extend ggplot in some shape or form
or simply work very well with it.</p>
<div id="ggsignif-ggpubr" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> <code>ggsignif</code>, <code>ggpubr</code><a class="anchor" aria-label="anchor" href="#ggsignif-ggpubr"><i class="fas fa-link"></i></a>
</h3>
<p>One of these is <code>ggsignif</code>, which we can use to add comparison
brackets to our plot.</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu"><a href="https://const-ae.github.io/ggsignif/reference/stat_signif.html">geom_signif</a></span><span class="op">(</span>
    comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gentoo"</span>, <span class="st">"Adelie"</span><span class="op">)</span><span class="op">)</span>,
    annotations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<p><code>ggsignif</code> can also run it’s own comparisons, which is
a wilcoxon rank sum test by default, but especially
for statistical tests I prefer to run them myself first
before trusting more packages.
Additionally, we have of course a different type of test (ANOVA),
and we already have our values, so we use it just to manually
add text to the annotation:</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0.001</span> <span class="op">~</span> <span class="st">"***"</span>,
    <span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0.01</span>  <span class="op">~</span> <span class="st">"**"</span>,
    <span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>  <span class="op">~</span> <span class="st">"*"</span>,
    <span class="cn">TRUE</span>       <span class="op">~</span> <span class="st">"ns"</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">dunnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span><span class="va">anova_fit</span>, <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Dunnet"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contrast <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">contrast</span>, <span class="st">" - "</span><span class="op">)</span>,
         stars    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/stars.html">stars</a></span><span class="op">(</span><span class="va">adj.p.value</span><span class="op">)</span><span class="op">)</span>

<span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>outlier.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu"><a href="https://const-ae.github.io/ggsignif/reference/stat_signif.html">geom_signif</a></span><span class="op">(</span>
    comparisons <span class="op">=</span> <span class="va">dunnet</span><span class="op">$</span><span class="va">contrast</span>,
    annotations <span class="op">=</span> <span class="va">dunnet</span><span class="op">$</span><span class="va">stars</span>,
    y_position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">65</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">plt</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
</div>
<div id="patchwork" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> <code>patchwork</code><a class="anchor" aria-label="anchor" href="#patchwork"><i class="fas fa-link"></i></a>
</h3>
<p>I also saved the plot to a variable and will now create a second
one just to show you the <code>patchwork</code> package,
which can combine plots into neat layouts:</p>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>

<span class="op">(</span><span class="op">(</span><span class="va">plt</span> <span class="op">|</span> <span class="va">plt2</span><span class="op">)</span> <span class="op">/</span> <span class="va">plt2</span> <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
</div>
<div id="ggfortify" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> <code>ggfortify</code><a class="anchor" aria-label="anchor" href="#ggfortify"><i class="fas fa-link"></i></a>
</h3>
<p><code>ggfortiy</code> might not strictly be necessary but I want to mention it
to talk about <code>autoplot</code>.
<code>autoplot</code> is in <code>ggplot2</code> already by default.
It creates automatic plot for certain objects, like models for example,
or an anova result.
<code>ggfortify</code> makes more objects have the ability to generate an autoplot.</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">anova_fit</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-12-1.png" width="100%"></div>
<p>I want to mention this here because it has an important implication
for communication.
There are two purposes too plots.
The first purpose is to generate insight for you, the data analyst.
Autoplots are often very helpful for this.
But the second purpose is to communicate your findings to a reader!
It takes time and effort to refine a plot from something that generated
and insight for you after having spent a lot of time with your data
to also generating insights for a reader that sees the data for the first time.
Too many people stop at the first step and publish their plots
as is, without thinking much about the reader.
Keep this in mind as you advance in your scientific career.</p>
<blockquote>
<p>Communication is key!
Both code and plots are means of communicating.</p>
</blockquote>
</div>
<div id="esquisse" class="section level3" number="8.3.4">
<h3>
<span class="header-section-number">8.3.4</span> <code>esquisse</code><a class="anchor" aria-label="anchor" href="#esquisse"><i class="fas fa-link"></i></a>
</h3>
<p>Two more cool packages: The <code>esquisse</code> package let’s you
create ggplots interactively with a gui!
But make sure to always save the code this created to ensure
reproducibility!</p>
</div>
<div id="gganimate" class="section level3" number="8.3.5">
<h3>
<span class="header-section-number">8.3.5</span> <code>gganimate</code><a class="anchor" aria-label="anchor" href="#gganimate"><i class="fas fa-link"></i></a>
</h3>
<p>And <code>gganimate</code> extends <code>ggplot</code> with the ability to use time as a dimension:</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gapminder/man/gapminder.html">gapminder</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, size <span class="op">=</span> <span class="va">pop</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># facet_wrap(~year) +</span>
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gapminder/man/country_colors.html">country_colors</a></span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span>,
         size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="08-freestyle_files/figure-html/unnamed-chunk-13-1.gif" width="100%"></div>
</div>
</div>
<div id="build-apps-with-shiny" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Build Apps with <code>shiny</code><a class="anchor" aria-label="anchor" href="#build-apps-with-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>You can find the code written during the lecture in: <code>example-app/</code>.</p>
</div>
<div id="exercises-7" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-7"><i class="fas fa-link"></i></a>
</h2>
<div id="the-whole-deal" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> The Whole Deal<a class="anchor" aria-label="anchor" href="#the-whole-deal"><i class="fas fa-link"></i></a>
</h3>
<p>Data analysis takes practice.
For this last exercise you get the option to show what you
have learned on a fresh dataset.
But people have different interests, so I am leaving
the choice open.</p>
<p>Choose a dataset from the TidyTuesday project:</p>
<p><a href="https://github.com/rfordatascience/tidytuesday#datasets" class="uri">https://github.com/rfordatascience/tidytuesday#datasets</a></p>
<p>and write your data analysis report.
Aim to write down some questions you have about the
topic and answer them with the available data.
Explore it with plots and tables and try
to end up with 1 or 2 high quality plots
that clearly communicate you findings.
Above all, have fun!</p>
</div>
</div>
<div id="feedback" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Feedback<a class="anchor" aria-label="anchor" href="#feedback"><i class="fas fa-link"></i></a>
</h2>
<p>I will send round a link for a feedback form.
It is anonymous.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="fallacies-correlation-and-regression.html"><span class="header-section-number">7</span> Fallacies, Correlation and Regression</a></div>
<div class="next"><a href="resources-5.html">Resources</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#freestyle"><span class="header-section-number">8</span> Freestyle</a></li>
<li><a class="nav-link" href="#setup-1"><span class="header-section-number">8.1</span> Setup</a></li>
<li>
<a class="nav-link" href="#anova"><span class="header-section-number">8.2</span> ANOVA</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tukey-post-hoc-test"><span class="header-section-number">8.2.1</span> Tukey Post-Hoc Test</a></li>
<li><a class="nav-link" href="#dunnet-post-hoc-test"><span class="header-section-number">8.2.2</span> Dunnet Post-Hoc Test</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot-extensions"><span class="header-section-number">8.3</span> ggplot extensions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggsignif-ggpubr"><span class="header-section-number">8.3.1</span> ggsignif, ggpubr</a></li>
<li><a class="nav-link" href="#patchwork"><span class="header-section-number">8.3.2</span> patchwork</a></li>
<li><a class="nav-link" href="#ggfortify"><span class="header-section-number">8.3.3</span> ggfortify</a></li>
<li><a class="nav-link" href="#esquisse"><span class="header-section-number">8.3.4</span> esquisse</a></li>
<li><a class="nav-link" href="#gganimate"><span class="header-section-number">8.3.5</span> gganimate</a></li>
</ul>
</li>
<li><a class="nav-link" href="#build-apps-with-shiny"><span class="header-section-number">8.4</span> Build Apps with shiny</a></li>
<li>
<a class="nav-link" href="#exercises-7"><span class="header-section-number">8.5</span> Exercises</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#the-whole-deal"><span class="header-section-number">8.5.1</span> The Whole Deal</a></li></ul>
</li>
<li><a class="nav-link" href="#feedback"><span class="header-section-number">8.6</span> Feedback</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jmbuhr/dataintro/blob/main/08-freestyle.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jmbuhr/dataintro/edit/main/08-freestyle.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction to Data Analysis with R</strong>" was written by Jannik Buhr. It was last built on 2022-01-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
